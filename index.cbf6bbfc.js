!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function e(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,r)}}function r(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r,n,a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var o=[],i=!0,s=!1;try{for(a=a.call(t);!(i=(r=a.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){s=!0,n=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}return o}}(t,r)||e(t,r)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(r){return function(e){if(Array.isArray(e))return t(e)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||e(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){n(document.getElementsByClassName("field-cell")).forEach(function(e,r){e.textContent="",e.className="field-cell",t[r]&&(e.textContent=t[r],e.classList.add("field-cell--".concat(t[r])))})}function i(t,e){var r=localStorage.getItem(t);null===r&&(r=e);try{r=JSON.parse(r)}catch(e){localStorage.removeItem(t)}return[r,function(e){localStorage.setItem(t,JSON.stringify(e))}]}var s=new(function(){var t;function e(){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),a(this,"gameStatus","idle"),a(this,"currentState",[]),a(this,"startState",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),a(this,"currentScore",0)}return t=[{key:"moveLeft",value:function(){var t=this.moveHorizontally(this.currentState);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}},{key:"moveRight",value:function(){var t=this.moveHorizontally(this.currentState,!0);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}},{key:"moveUp",value:function(){var t=this.moveVertically(this.currentState);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}},{key:"moveDown",value:function(){var t=this.moveVertically(this.currentState,!0);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}},{key:"getScore",value:function(){var t=n(document.getElementsByClassName("game-score"))[1],e=r(i("bestScore",0),2)[1],a=r(i("currentScore",0),2)[1],o=document.querySelector(".best");t.textContent=this.currentScore,a(this.currentScore),this.currentScore>o.textContent&&(e(this.currentScore),o.textContent=this.currentScore)}},{key:"getState",value:function(t){var e,n=function(t,e){var r,n,a=[];if(t.flat().forEach(function(t,e){0===t&&a.push(e)}),0===a.length)return[];if("playing"===e){do r=Math.floor(16*Math.random());while(!a.includes(r))return[r]}do r=Math.floor(16*Math.random()),n=Math.floor(16*Math.random());while(!a.includes(r)||!a.includes(n)||r===n)return[r,n]}(t,this.gameStatus),a=(e=[],t.flat().forEach(function(t,r){var a=0===Math.floor(10*Math.random())?4:2;n.includes(r)?e.push(a):e.push(t)}),e),s=r(i("gameState",this.startState),2)[1];this.currentState=function(t){for(var e=[],r=0,n=1;n<=t.length;n++)n%4==0&&(e.push(t.slice(r,n)),r=n);return e}(a),o(a),this.getScore(),this.searchMoveOpportunity(a,this.currentState),this.search2048Cell(a),"lose"!==this.gameStatus&&"win"!==this.gameStatus&&s(this.currentState)}},{key:"getStatus",value:function(){return this.gameStatus}},{key:"start",value:function(){this.getState(this.startState),this.gameStatus="playing",(0,r(i("gameStatus","playing"),2)[1])("playing")}},{key:"restart",value:function(){this.gameStatus="idle",this.currentScore=0,this.getState(this.startState),localStorage.removeItem("currentScore"),this.gameStatus="playing"}},{key:"moveVertically",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[[],[],[],[]];return t.forEach(function(a,o){var i=Array.from({length:4},function(e,r){return t[r][o]});r&&i.reverse();var s=i.filter(function(t){return t});if(i.every(function(t){return!t})&&n.forEach(function(t){return t.push(0)}),1===s.length&&(i.sort(function(t,e){return e-t}),n.forEach(function(t,e){return t.push(i[e])})),s.length>1){var u=e.mergeAdjacentCells(s).filter(function(t){return t});n.forEach(function(t,e){return t.push(u[e]||0)})}}),r&&n.reverse(),n}},{key:"moveHorizontally",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[[],[],[],[]];return t.forEach(function(a,o){var i=Array.from({length:4},function(e,r){return t[o][r]});r&&i.reverse();var s=i.filter(function(t){return t});if(i.every(function(t){return!t})&&i.forEach(function(){return n[o].push(0)}),1===s.length&&(n[o]=i.sort(function(t,e){return e-t})),s.length>1)for(var u=e.mergeAdjacentCells(s).filter(function(t){return t}),c=0;c<4;c++)n[o].push(u[c]||0)}),r&&n.forEach(function(t){return t.reverse()}),n}},{key:"mergeAdjacentCells",value:function(t){for(var e=[,,,,].fill(0),r=0;r<t.length;)t[r]===t[r+1]?(e[r]=t[r]+t[r+1],this.currentScore+=e[r],r+=2):(e[r]=t[r],r++);return e}},{key:"searchMoveOpportunity",value:function(t,e){if(t.every(function(t){return t})){for(var r=function(t){var r=Array.from({length:4},function(r,n){return e[n][t]}),a=Array.from({length:4},function(r,n){return e[t][n]});(r.some(function(t,e){return e>0&&t===r[e-1]})||a.some(function(t,e){return e>0&&t===a[e-1]}))&&(n=!0)},n=!1,a=0;a<e.length;a++)r(a);n||(this.gameStatus="lose",localStorage.removeItem("gameStatus"),localStorage.removeItem("gameState"))}}},{key:"search2048Cell",value:function(t){var e=this;t.forEach(function(t){2048===t&&(e.gameStatus="win",localStorage.removeItem("gameStatus"),localStorage.removeItem("gameState"))})}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}()),u=document.getElementsByClassName("button")[0],c=document.getElementsByClassName("message"),l=document.querySelector(".best"),f=n(document.getElementsByClassName("game-score"))[1],h=r(i("bestScore",0),1)[0],g=r(i("currentScore",0),1)[0],m=r(i("gameState",s.startState),1)[0],S=r(i("gameStatus","idle"),1)[0];"playing"===S&&(s.currentState=m,s.currentScore=g,f.textContent=g,o(m.flat()),s.gameStatus=S,u.classList.remove("start"),u.classList.add("restart"),u.textContent="Restart",c[2].classList.toggle("hidden")),l.textContent=h,u.onclick=function(){if("idle"===s.getStatus()&&(u.classList.remove("start"),u.classList.add("restart"),u.textContent="Restart",c[2].classList.toggle("hidden"),s.start()),"playing"===s.getStatus()&&s.restart(),"lose"===s.getStatus()||"win"===s.getStatus()){var t="lose"===s.getStatus()?0:1;s.restart(),c[t].classList.toggle("hidden")}};var v=function(t){if("idle"!==s.getStatus()){switch(t.key){case"ArrowUp":s.moveUp();break;case"ArrowRight":s.moveRight();break;case"ArrowDown":s.moveDown();break;case"ArrowLeft":s.moveLeft()}("lose"===s.getStatus()||"win"===s.getStatus())&&(c["lose"===s.getStatus()?0:1].classList.toggle("hidden"),removeEventListener("keydown",v))}};addEventListener("keydown",v);var y=null,d=null,p=function(t){y=t.touches[0].clientX,d=t.touches[0].clientY},b=function(t){if("idle"!==s.getStatus()){var e=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY,n=e-y,a=r-d;Math.abs(n)>Math.abs(a)&&Math.abs(n)>50?n>0?s.moveRight():s.moveLeft():Math.abs(a)>50&&(a>0?s.moveDown():s.moveUp()),("lose"===s.getStatus()||"win"===s.getStatus())&&(c["lose"===s.getStatus()?0:1].classList.toggle("hidden"),removeEventListener("touchstart",p),removeEventListener("touchend",b))}};addEventListener("touchstart",p),addEventListener("touchend",b)}();
//# sourceMappingURL=index.cbf6bbfc.js.map
