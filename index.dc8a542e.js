function t(t){[...document.getElementsByClassName("field-cell")].forEach((e,r)=>{e.textContent="",e.className="field-cell",t[r]&&(e.textContent=t[r],e.classList.add(`field-cell--${t[r]}`))})}function e(t,e){let r=localStorage.getItem(t);null===r&&(r=e);try{r=JSON.parse(r)}catch{localStorage.removeItem(t)}return[r,e=>{localStorage.setItem(t,JSON.stringify(e))}]}const r=new class{gameStatus="idle";currentState=[];startState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];currentScore=0;moveLeft(){let t=this.moveHorizontally(this.currentState);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}moveRight(){let t=this.moveHorizontally(this.currentState,!0);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}moveUp(){let t=this.moveVertically(this.currentState);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}moveDown(){let t=this.moveVertically(this.currentState,!0);JSON.stringify(this.currentState)!==JSON.stringify(t)&&this.getState(t)}getScore(){let t=[...document.getElementsByClassName("game-score")][1],[,r]=e("bestScore",0),[,s]=e("currentScore",0),a=document.querySelector(".best");t.textContent=this.currentScore,s(this.currentScore),this.currentScore>a.textContent&&(r(this.currentScore),a.textContent=this.currentScore)}getState(r){let s=function(t,e){let r,s;let a=[];if(t.flat().forEach((t,e)=>{0===t&&a.push(e)}),0===a.length)return[];if("playing"===e){do r=Math.floor(16*Math.random());while(!a.includes(r))return[r]}do r=Math.floor(16*Math.random()),s=Math.floor(16*Math.random());while(!a.includes(r)||!a.includes(s)||r===s)return[r,s]}(r,this.gameStatus),a=function(t,e){let r=[];return t.flat().forEach((t,s)=>{let a=0===Math.floor(10*Math.random())?4:2;e.includes(s)?r.push(a):r.push(t)}),r}(r,s),[,l]=e("gameState",this.startState);this.currentState=function(t){let e=[],r=0;for(let s=1;s<=t.length;s++)s%4==0&&(e.push(t.slice(r,s)),r=s);return e}(a),t(a),this.getScore(),this.searchMoveOpportunity(a,this.currentState),this.search2048Cell(a),"lose"!==this.gameStatus&&"win"!==this.gameStatus&&l(this.currentState)}getStatus(){return this.gameStatus}start(){this.getState(this.startState),this.gameStatus="playing";let[,t]=e("gameStatus","playing");t("playing")}restart(){this.gameStatus="idle",this.currentScore=0,this.getState(this.startState),localStorage.removeItem("currentScore"),this.gameStatus="playing"}moveVertically(t,e=!1){let r=[[],[],[],[]];return t.forEach((s,a)=>{let l=Array.from({length:4},(e,r)=>t[r][a]);e&&l.reverse();let o=l.filter(t=>t);if(l.every(t=>!t)&&r.forEach(t=>t.push(0)),1===o.length&&(l.sort((t,e)=>e-t),r.forEach((t,e)=>t.push(l[e]))),o.length>1){let t=this.mergeAdjacentCells(o).filter(t=>t);r.forEach((e,r)=>e.push(t[r]||0))}}),e&&r.reverse(),r}moveHorizontally(t,e=!1){let r=[[],[],[],[]];return t.forEach((s,a)=>{let l=Array.from({length:4},(e,r)=>t[a][r]);e&&l.reverse();let o=l.filter(t=>t);if(l.every(t=>!t)&&l.forEach(()=>r[a].push(0)),1===o.length&&(r[a]=l.sort((t,e)=>e-t)),o.length>1){let t=this.mergeAdjacentCells(o).filter(t=>t);for(let e=0;e<4;e++)r[a].push(t[e]||0)}}),e&&r.forEach(t=>t.reverse()),r}mergeAdjacentCells(t){let e=[,,,,].fill(0);for(let r=0;r<t.length;)t[r]===t[r+1]?(e[r]=t[r]+t[r+1],this.currentScore+=e[r],r+=2):(e[r]=t[r],r++);return e}searchMoveOpportunity(t,e){if(t.every(t=>t)){let t=!1;for(let r=0;r<e.length;r++){let s=Array.from({length:4},(t,s)=>e[s][r]),a=Array.from({length:4},(t,s)=>e[r][s]);(s.some((t,e)=>e>0&&t===s[e-1])||a.some((t,e)=>e>0&&t===a[e-1]))&&(t=!0)}t||(this.gameStatus="lose",localStorage.removeItem("gameStatus"),localStorage.removeItem("gameState"))}}search2048Cell(t){t.forEach(t=>{2048===t&&(this.gameStatus="win",localStorage.removeItem("gameStatus"),localStorage.removeItem("gameState"))})}},s=document.getElementsByClassName("button")[0],a=document.getElementsByClassName("message"),l=document.querySelector(".best"),o=[...document.getElementsByClassName("game-score")][1],[n]=e("bestScore",0),[i]=e("currentScore",0),[c]=e("gameState",r.startState),[h]=e("gameStatus","idle");"playing"===h&&(r.currentState=c,r.currentScore=i,o.textContent=i,t(c.flat()),r.gameStatus=h,s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart",a[2].classList.toggle("hidden")),l.textContent=n,s.onclick=()=>{if("idle"===r.getStatus()&&(s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart",a[2].classList.toggle("hidden"),r.start()),"playing"===r.getStatus()&&r.restart(),"lose"===r.getStatus()||"win"===r.getStatus()){let t="lose"===r.getStatus()?0:1;r.restart(),a[t].classList.toggle("hidden")}};const g=t=>{if("idle"!==r.getStatus()){switch(t.key){case"ArrowUp":r.moveUp();break;case"ArrowRight":r.moveRight();break;case"ArrowDown":r.moveDown();break;case"ArrowLeft":r.moveLeft()}("lose"===r.getStatus()||"win"===r.getStatus())&&(a["lose"===r.getStatus()?0:1].classList.toggle("hidden"),removeEventListener("keydown",g))}};addEventListener("keydown",g);let u=null,S=null;const m=t=>{u=t.touches[0].clientX,S=t.touches[0].clientY},f=t=>{if("idle"===r.getStatus())return;let e=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,l=e-u,o=s-S;Math.abs(l)>Math.abs(o)&&Math.abs(l)>50?l>0?r.moveRight():r.moveLeft():Math.abs(o)>50&&(o>0?r.moveDown():r.moveUp()),("lose"===r.getStatus()||"win"===r.getStatus())&&(a["lose"===r.getStatus()?0:1].classList.toggle("hidden"),removeEventListener("touchstart",m),removeEventListener("touchend",f))};addEventListener("touchstart",m),addEventListener("touchend",f);
//# sourceMappingURL=index.dc8a542e.js.map
